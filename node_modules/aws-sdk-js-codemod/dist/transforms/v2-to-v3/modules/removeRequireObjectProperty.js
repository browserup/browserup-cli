"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.removeRequireObjectProperty = void 0;
const config_1 = require("../config");
const getRequireDeclaratorsWithObjectPattern_1 = require("./getRequireDeclaratorsWithObjectPattern");
const removeRequireObjectProperty = (j, source, { localName, sourceValue }) => {
    const requireDeclarators = (0, getRequireDeclaratorsWithObjectPattern_1.getRequireDeclaratorsWithObjectPattern)(j, source, {
        identifierName: localName,
        sourceValue,
    });
    requireDeclarators.forEach((varDeclarator) => {
        const varDeclarationCollection = j(varDeclarator).closest(j.VariableDeclaration);
        // Remove ObjectProperty from Variable Declarator.
        const varDeclaratorId = varDeclarator.value.id;
        varDeclaratorId.properties = varDeclaratorId.properties.filter((property) => {
            if (!config_1.OBJECT_PROPERTY_TYPE_LIST.includes(property.type))
                return true;
            const propertyValue = property.value;
            return propertyValue.type !== "Identifier" || propertyValue.name !== localName;
        });
        // Remove VariableDeclarator if there are no properties.
        if (varDeclaratorId.properties.length === 0) {
            j(varDeclarator).remove();
            // Remove VariableDeclaration if there are no declarations.
            const varDeclaration = varDeclarationCollection.nodes()[0];
            if (varDeclaration && varDeclaration.declarations?.length === 0) {
                varDeclarationCollection.remove();
            }
        }
    });
};
exports.removeRequireObjectProperty = removeRequireObjectProperty;
