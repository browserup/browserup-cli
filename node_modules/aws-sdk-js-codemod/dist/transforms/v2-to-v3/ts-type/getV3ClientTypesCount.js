"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.getV3ClientTypesCount = void 0;
const config_1 = require("../config");
const getClientTypeNames_1 = require("./getClientTypeNames");
const arrayBracketRegex = /<([\w]+)>/g;
const recordBracketRegex = /<string, ([\w]+)>/g;
const nativeTypes = ["string", "number", "boolean", "Date", "Uint8Array"];
const getTypesFromString = (str) => {
    const arraryMatches = [...str.matchAll(arrayBracketRegex)].map((match) => match[1]);
    const recordMatches = [...str.matchAll(recordBracketRegex)].map((match) => match[1]);
    return [...arraryMatches, ...recordMatches];
};
const getV3ClientTypesCount = (j, source, options) => {
    const { v2ClientName } = options;
    const clientTypeNames = (0, getClientTypeNames_1.getClientTypeNames)(j, source, options);
    const clientTypesMap = config_1.CLIENT_TYPES_MAP[v2ClientName];
    const v3ClientUnavailableTypes = Object.keys(clientTypesMap);
    return clientTypeNames.filter((clientTypeName) => {
        if (!v3ClientUnavailableTypes.includes(clientTypeName)) {
            return true;
        }
        const typesFromString = getTypesFromString(clientTypesMap[clientTypeName]);
        return typesFromString.some((type) => !nativeTypes.includes(type));
    }).length;
};
exports.getV3ClientTypesCount = getV3ClientTypesCount;
